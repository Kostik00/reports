<?xml version="1.0" encoding="utf-8"?>
<TfrxReport Version="5.5.2" DotMatrixReport="False" IniFile="\Software\Fast Reports" PreviewOptions.Buttons="2047" PreviewOptions.Zoom="1" PrintOptions.Printer="По умолчанию" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="42730,4483064583" ReportOptions.Description.Text="" ReportOptions.Name="Остаток трудоемкости по видам работ.fr3 Справочник изделий" ReportOptions.LastChange="42731,477415162" ScriptLanguage="PascalScript" ScriptText.Text="&#13;&#10;procedure Page1OnBeforePrint(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  PrepQRY.ExecSQL;&#13;&#10;end;&#13;&#10;&#13;&#10;begin&#13;&#10;&#13;&#10;end." StoreInDFM="False">
  <Datasets>
    <item DataSet="MainFrxDS" DataSetName="MainDS"/>
    <item DataSet="DetailQRY" DataSetName="DetailQRY"/>
    <item DataSet="PrepQRY" DataSetName="PrepQRY"/>
  </Datasets>
  <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000">
    <TfrxERQuery Name="DetailQRY" UserName="DetailQRY" CloseDataSource="True" FieldAliases.Text="" BCDToCurrency="False" Master="MainFrxDS" IgnoreDupParams="False" SQL.Text="if object_id(N'tempdb..#TmpMKByTP') is  null&#13;&#10;BEGIN          &#13;&#10;&#13;&#10;	CREATE TABLE #TmpMKByTP&#13;&#10;	(&#13;&#10;		Key_TmpMK int not null identity(1,1), &#13;&#10;		Key_VKZ_Izdel int,&#13;&#10;		Key_Predm int,&#13;&#10;		Key_TpRows int,&#13;&#10;		Key_V_TP int,&#13;&#10;		TPz float,&#13;&#10;		TSht float,&#13;&#10;		TPz1 float null,&#13;&#10;		Key_Master int null,&#13;&#10;		Lvl int null,&#13;&#10;		Key_TmpMK_Master int null&#13;&#10;&#13;&#10;	)&#13;&#10;END      &#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;SELECT  T1.Name_GrGr, T2.Key_VKZ_Izdel, T2.TSm, T3.T_SmSm                       &#13;&#10;FROM&#13;&#10;	(&#13;&#10;		SELECT  DISTINCT &#13;&#10;			Name_GrGr&#13;&#10;		FROM T_Oper_Gr&#13;&#10;	) T1&#13;&#10;&#13;&#10;LEFT JOIN &#13;&#10;(&#13;&#10;	SELECT &#13;&#10;		P_VKZ_SmPos.Key_VKZ_Izdel,&#13;&#10;		T_Oper_Gr.Name_GrGr,&#13;&#10;		&#13;&#10;		SUM(Isnull(#TmpMKByTP.TPz,0) + Isnull(#TmpMKByTP.TSht,0) *  (P_VKZ_SmPos.PredmKolvo-P_VKZ_SmPos.PaspKolvo)) TSm&#13;&#10;		FROM &#13;&#10;		dbo.P_VKZ_SmPos1  P_VKZ_SmPos&#13;&#10;		INNER JOIN #TmpMKByTP&#13;&#10;			ON #TmpMKByTP.Key_VKZ_Izdel = P_VKZ_SmPos.Key_VKZ_Izdel&#13;&#10;			AND #TmpMKByTP.Key_Predm  = P_VKZ_SmPos.Key_Predm&#13;&#10;&#13;&#10;		INNER JOIN T_TPRows&#13;&#10;			ON T_TPRows.Key_TPRows = #TmpMKByTP.Key_TpRows&#13;&#10;		INNER JOIN T_Oper&#13;&#10;			ON T_Oper.Cod_Oper = T_TPRows.Cod_Oper&#13;&#10;		INNER JOIN T_Oper_Gr&#13;&#10;			ON T_Oper_Gr.Cod_Oper_Gr = T_Oper.Cod_Oper_Gr&#13;&#10; WHERE&#13;&#10;       (P_VKZ_SmPos.PredmKolvo-P_VKZ_SmPos.PaspKolvo) &#62; 0              &#13;&#10;       AND P_VKZ_SmPos.Key_VKZ_Izdel = :Key_VKZ_Izdel            &#13;&#10;	GROUP BY &#13;&#10;		P_VKZ_SmPos.Key_VKZ_Izdel,&#13;&#10;		T_Oper_Gr.Name_GrGr&#13;&#10;&#13;&#10;    &#13;&#10;&#13;&#10;&#13;&#10;) T2&#13;&#10;	ON T2.Name_GrGr = T1.Name_GrGr&#13;&#10;&#13;&#10;LEFT JOIN&#13;&#10;(&#13;&#10;&#13;&#10;SELECT T1.Key_VKZ_Izdel, T1.Name_GrGr, SUM(T1.T_SmSm) T_SmSm, SUM(T1.T_SmSm1) T_SmSm1&#13;&#10;		FROM&#13;&#10;		(&#13;&#10;			SELECT     &#13;&#10;				P_VKZ_SmPos.Key_VKZ_Izdel, &#13;&#10;				P_VKZ_SmPos.Key_Predm, &#13;&#10;				P_VKZ_SmPos.PredmKolvo,&#13;&#10;				P_VKZ_SmPos.PaspKolvo,&#13;&#10;				T_Oper_Gr.Name_GrGr,&#13;&#10;&#13;&#10;&#13;&#10;				SUM(Isnull(Isnull(Pr_Pasp_Rows.Tpz,T_TPRows.Tpz),0)*Pr_PaspDet.KolvoZap / Pr_Pasp.PaspKolvo)	Tpz , &#13;&#10;				SUM(Isnull(Isnull(Pr_Pasp_Rows.Tsht, T_TPRows.Tsht),0))						Tsht,&#13;&#10;				SUM(Isnull(Pr_Pasp_Rows.Tsm,0)*Pr_PaspDet.KolvoZap* (Pr_Pasp_Ac_SM.Ost / Pr_Pasp.PaspKolvo) / Pr_Pasp.PaspKolvo)		T_SmSm,&#13;&#10;				(&#13;&#10;				SUM((Isnull(Isnull(Pr_Pasp_Rows.Tpz,T_TPRows.Tpz),0)*Pr_PaspDet.KolvoZap / Pr_Pasp.PaspKolvo ) * Pr_Pasp_Ac_SM.Ost / Pr_Pasp.PaspKolvo) +&#13;&#10;				SUM((Isnull(Isnull(Pr_Pasp_Rows.Tsht, T_TPRows.Tsht),0))* Pr_Pasp_Ac_SM.Ost / Pr_Pasp.PaspKolvo)*P_VKZ_SmPos.PaspKolvo   &#13;&#10;				)  T_SmSm1&#13;&#10;&#13;&#10;			FROM         &#13;&#10;				P_VKZ_SmPos1 P_VKZ_SmPos &#13;&#10;				INNER JOIN P_VKZ &#13;&#10;					ON P_VKZ_SmPos.Key_VKZ_Izdel = P_VKZ.Key_VKZ_Izdel &#13;&#10;					AND P_VKZ_SmPos.Key_Predm = P_VKZ.Key_Predm &#13;&#10;				INNER JOIN Pr_PaspDet &#13;&#10;					ON P_VKZ.Key_VKZ = Pr_PaspDet.Key_VKZ &#13;&#10;				INNER JOIN Pr_Pasp &#13;&#10;					ON Pr_PaspDet.Key_Pasport = Pr_Pasp.Key_Pasport &#13;&#10;				INNER JOIN Pr_Pasp_Rows &#13;&#10;					ON Pr_Pasp.Key_Pasport = Pr_Pasp_Rows.Key_Pasport&#13;&#10;				INNER JOIN T_TPRows&#13;&#10;					ON T_TPRows.Key_TPRows = Pr_Pasp_Rows.Key_TPRows&#13;&#10;				INNER JOIN Pr_Pasp_Ac_SM&#13;&#10;					ON Pr_Pasp_Ac_SM.Key_Pasp_Rows=Pr_Pasp_Rows.Key_Pasp_Rows&#13;&#10;					AND Pr_Pasp_Ac_SM.Ost &#62; 0&#13;&#10;&#13;&#10;				INNER JOIN T_Oper&#13;&#10;					ON T_Oper.Cod_Oper=T_TPRows.Cod_Oper&#13;&#10;				INNER JOIN T_Oper_Gr&#13;&#10;					ON T_Oper_Gr.Cod_Oper_Gr = T_Oper.Cod_Oper_Gr&#13;&#10;			WHERE&#13;&#10;				Pr_Pasp.PaspKolvo&#62;0&#13;&#10;    AND P_VKZ_SmPos.Key_VKZ_Izdel = :Key_VKZ_Izdel                                                                     &#13;&#10;			GROUP BY &#13;&#10;				P_VKZ_SmPos.Key_VKZ_Izdel, &#13;&#10;				P_VKZ_SmPos.Key_Predm, &#13;&#10;				P_VKZ_SmPos.PredmKolvo,&#13;&#10;				P_VKZ_SmPos.PaspKolvo,&#13;&#10;				T_Oper_Gr.Name_GrGr&#13;&#10;&#13;&#10;&#13;&#10;		) T1&#13;&#10;		GROUP BY T1.Key_VKZ_Izdel, T1.Name_GrGr    &#13;&#10;) T3        &#13;&#10;	ON T3.Name_GrGr = T1.Name_GrGr&#13;&#10;  &#13;&#10;ORDER BY Name_GrGr&#13;&#10;    " PropData="05704C65667403CC000470546F7002680A506172616D657465727301010C2A000000204E616D653D224B65795F564B5A5F497A64656C222044617461547970653D226674556E6B6E6F776E220000"/>
    <TfrxERQuery Name="PrepQRY" UserName="PrepQRY" CloseDataSource="True" FieldAliases.Text="" BCDToCurrency="False" IgnoreDupParams="False" SQL.Text="if object_id(N'tempdb..#TmpMKByTP') is  null&#13;&#10;&#13;&#10;	CREATE TABLE #TmpMKByTP&#13;&#10;	(&#13;&#10;		Key_TmpMK int not null identity(1,1), &#13;&#10;		Key_VKZ_Izdel int,&#13;&#10;		Key_Predm int,&#13;&#10;		Key_TpRows int,&#13;&#10;		Key_V_TP int,&#13;&#10;		TPz float,&#13;&#10;		TSht float,&#13;&#10;		TPz1 float null,&#13;&#10;		Key_Master int null,&#13;&#10;		Lvl int null,&#13;&#10;		Key_TmpMK_Master int null&#13;&#10;&#13;&#10;	)&#13;&#10;  &#13;&#10;ELSE&#13;&#10;		TRUNCATE TABLE #TmpMKByTP&#13;&#10;&#13;&#10;&#13;&#10;	INSERT INTO #TmpMKByTP &#13;&#10;		( &#13;&#10;		Key_VKZ_Izdel,&#13;&#10;		Key_Predm,&#13;&#10;		Key_TpRows,&#13;&#10;		Key_V_TP,&#13;&#10;		TPz,&#13;&#10;		TSht,&#13;&#10;		Lvl)&#13;&#10;	SELECT &#13;&#10;		P_VKZ.Key_VKZ_Izdel, &#13;&#10;		P_VKZ.Key_Predm,&#13;&#10;		T_TPRows.Key_TPRows,&#13;&#10;		T_TPRows.Key_V_TP,&#13;&#10;		T_TPRows.Tpz,&#13;&#10;		T_TPRows.Tsht	  ,&#13;&#10;		1&#13;&#10;	FROM dbo.P_VKZ_SmPos P_VKZ&#13;&#10;		INNER JOIN T_Predm&#13;&#10;			ON T_Predm.Key_Predm = P_VKZ.Key_Predm&#13;&#10;		INNER JOIN T_SP&#13;&#10;			ON T_SP.Key_Predm = T_Predm.Key_Predm&#13;&#10;			AND T_SP.SP_Version = T_Predm.SP_Version&#13;&#10;		INNER JOIN T_TP&#13;&#10;			ON T_TP.Key_TP=T_SP.Key_TP&#13;&#10;		INNER JOIN T_TPRows&#13;&#10;			ON T_TPRows.Key_TP = T_SP.Key_TP&#13;&#10;&#13;&#10;&#13;&#10;	INSERT INTO #TmpMKByTP &#13;&#10;		( &#13;&#10;		Key_VKZ_Izdel,&#13;&#10;		Key_Predm,&#13;&#10;		Key_TpRows,&#13;&#10;		Key_V_TP,&#13;&#10;		TPz,&#13;&#10;		TSht,&#13;&#10;		Key_Master,&#13;&#10;		Lvl,&#13;&#10;		Key_TmpMK_Master)&#13;&#10;	SELECT &#13;&#10;		TmpMK.Key_VKZ_Izdel,&#13;&#10;		TmpMK.Key_Predm,&#13;&#10;		T_TPRows.Key_TpRows,&#13;&#10;		T_TPRows.Key_V_TP,&#13;&#10;		T_TPRows.Tpz,&#13;&#10;		T_TPRows.TSht,&#13;&#10;		TmpMK.Key_TmpMK,&#13;&#10;		TmpMK.Lvl+1,&#13;&#10;		TmpMK.Key_TmpMK&#13;&#10;	FROM #TmpMKByTP TmpMK&#13;&#10;		INNER JOIN T_TPRows T0&#13;&#10;			ON T0.Key_TPRows =  TmpMK.Key_TPRows&#13;&#10;--			AND (Isnull(T0.Tpz,0)+Isnull(T0.TSht,0)) = 0&#13;&#10;  &#13;&#10;&#13;&#10;		INNER JOIN T_TPRows&#13;&#10;			ON T_TPRows.Key_TP = TmpMK.Key_V_TP&#13;&#10;			AND ((T0.N_Oper_MK=T_TPRows.N_Oper_MK)OR(T_TPRows.N_Oper_MK = ''))&#13;&#10;&#13;&#10;	UPDATE #TmpMKByTP&#13;&#10;	SET &#13;&#10;		Tpz = 0,&#13;&#10;		TSht= 0&#13;&#10;	FROM  &#13;&#10;	  (	SELECT DISTINCT Key_TmpMK_Master &#13;&#10;		FROM #TmpMKByTP T001 &#13;&#10;		WHERE &#13;&#10;			(Isnull(T001.Tpz,0)+Isnull(T001.TSht,0)) &#62; 0&#13;&#10;	  ) T00&#13;&#10;	WHERE #TmpMKByTP.Key_TmpMK = T00.Key_TmpMK_Master&#13;&#10;&#13;&#10;	  " PropData="05704C656674021C0470546F7002140A506172616D65746572730100"/>
  </TfrxDataPage>
  <TfrxReportPage Name="Page1" Orientation="poLandscape" PaperWidth="297" PaperHeight="210" PaperSize="9" LeftMargin="10" RightMargin="10" TopMargin="10" BottomMargin="10" ColumnWidth="0" ColumnPositions.Text="" EndlessHeight="True" EndlessWidth="True" HGuides.Text="" VGuides.Text="" OnBeforePrint="Page1OnBeforePrint">
    <TfrxReportTitle Name="ReportTitle1" FillType="ftBrush" FillGap.Top="0" FillGap.Left="0" FillGap.Bottom="0" FillGap.Right="0" Height="20" Left="0" Top="16" Width="1046,92981"/>
    <TfrxMasterData Name="MasterData1" FillType="ftBrush" FillGap.Top="0" FillGap.Left="0" FillGap.Bottom="0" FillGap.Right="0" Height="18,89765" Left="0" Top="240" Width="1046,92981" ColumnWidth="0" ColumnGap="0" DataSet="MainFrxDS" DataSetName="MainDS" RowCount="0" Stretched="True">
      <TfrxMemoView Name="MainDSCod_Predm" Left="98,26778" Top="0" Width="264,5671" Height="18,89765" StretchMode="smMaxHeight" DataSet="MainFrxDS" DataSetName="MainDS" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" ParentFont="False" VAlign="vaCenter" Text="[MainDS.&#34;Cod_Predm&#34;] [MainDS.&#34;Name_Predm&#34;]"/>
      <TfrxMemoView Name="DetailQRYTSm" Left="385,51206" Top="0" Width="60,47248" Height="18,89765" StretchMode="smMaxHeight" DataSet="DetailQRY" DataSetName="DetailQRY" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[&#60;DetailQRY.&#34;TSm&#34;&#62;+&#60;DetailQRY.&#34;T_SmSm&#34;&#62;]">
        <Formats>
          <item FormatStr="%2.2f" Kind="fkNumeric"/>
          <item FormatStr="%2.2f" Kind="fkNumeric"/>
        </Formats>
      </TfrxMemoView>
      <TfrxMemoView Name="Memo2" Left="468,66172" Top="0" Width="117,16543" Height="18,89765" StretchMode="smMaxHeight" DataSet="DetailQRY" DataSetName="DetailQRY" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haRight" ParentFont="False" VAlign="vaCenter" Text="[SUM(&#60;DetailQRY.&#34;TSm&#34;&#62;,MasterData2) + SUM(&#60;DetailQRY.&#34;T_SmSm&#34;&#62;,MasterData2)] ">
        <Formats>
          <item FormatStr="%2.2f" Kind="fkNumeric"/>
          <item FormatStr="%2.2f" Kind="fkNumeric"/>
          <item FormatStr="%2.2f" Kind="fkNumeric"/>
          <item FormatStr="%2.2f" Kind="fkNumeric"/>
        </Formats>
      </TfrxMemoView>
      <TfrxMemoView Name="MainDSCod_Zak" Left="22,67718" Top="0" Width="75,5906" Height="18,89765" StretchMode="smMaxHeight" DataField="Cod_Zak" DataSet="MainFrxDS" DataSetName="MainDS" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" ParentFont="False" VAlign="vaCenter" Text="[MainDS.&#34;Cod_Zak&#34;]"/>
    </TfrxMasterData>
    <TfrxColumnHeader Name="ColumnHeader1" FillType="ftBrush" FillGap.Top="0" FillGap.Left="0" FillGap.Bottom="0" FillGap.Right="0" Height="162,51979" Left="0" Top="56" Width="1046,92981">
      <TfrxMemoView Name="DetailQRYName_GrGr" Left="385,51206" Top="0" Width="60,47243118" Height="162,51979" DataField="Name_GrGr" DataSet="DetailQRY" DataSetName="DetailQRY" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" ParentFont="False" Rotation="90" VAlign="vaCenter" Text="[DetailQRY.&#34;Name_GrGr&#34;]"/>
      <TfrxMemoView Name="Memo3" Left="468,66172" Top="0" Width="117,16533541" Height="162,51979" DataSet="DetailQRY" DataSetName="DetailQRY" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" ParentFont="False" Rotation="90" VAlign="vaCenter" Text="РС‚РѕРіРѕ РїРѕ РІСЃРµРј РІРёРґР°Рј СЂР°Р±РѕС‚"/>
      <TfrxMemoView Name="Memo1" Left="98,26778" Top="0" Width="264,5671" Height="162,51979" StretchMode="smMaxHeight" DataSet="MainFrxDS" DataSetName="MainDS" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РР·РґРµР»РёРµ">
        <Formats>
          <item/>
          <item/>
        </Formats>
      </TfrxMemoView>
      <TfrxMemoView Name="Memo5" Left="22,67718" Top="0" Width="75,5906" Height="162,51979" StretchMode="smMaxHeight" DataSet="MainFrxDS" DataSetName="MainDS" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="в„– Р·Р°РєР°Р·Р°"/>
    </TfrxColumnHeader>
    <TfrxHeader Name="Header1" FillType="ftBrush" FillGap.Top="0" FillGap.Left="0" FillGap.Bottom="0" FillGap.Right="0" Height="718,1107" Left="22,67718" Top="0" Vertical="True" Width="340,1577"/>
    <TfrxMasterData Name="MasterData2" FillType="ftBrush" FillGap.Top="0" FillGap.Left="0" FillGap.Bottom="0" FillGap.Right="0" Height="718,1107" Left="385,51206" Top="0" Vertical="True" Width="60,47248" ColumnWidth="0" ColumnGap="0" DataSet="DetailQRY" DataSetName="DetailQRY" RowCount="0"/>
    <TfrxFooter Name="Footer1" FillType="ftBrush" FillGap.Top="0" FillGap.Left="0" FillGap.Bottom="0" FillGap.Right="0" Height="718,1107" Left="468,66172" Top="0" Vertical="True" Width="117,16543"/>
  </TfrxReportPage>
</TfrxReport>
